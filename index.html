<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Smart Seed ‚Äî Detector + Meter + Report</title>
<style>
  :root{
    --bg:#f4f7f6; --muted:#444; --accent:#1e7f3f; --bad:#d9534f; --good:#16a34a;
  }
  body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--muted);display:flex;flex-direction:column;align-items:center;padding:18px}
  h1{margin:6px 0 12px;color:var(--accent)}
  .card{width:100%;max-width:720px;background:#fff;border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  video{width:100%;max-width:420px;border-radius:12px;background:black;object-fit:cover}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  button,select{padding:10px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.08);background:transparent}
  .btn-primary{background:var(--accent);color:#fff;border:none}
  .btn-ghost{background:transparent}
  .overlayCircle{
    position:relative;
    width:420px;max-width:90%;
  }
  .guide{
    position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
    width:110px;height:110px;border-radius:50%;
    border:3px dashed rgba(255,255,255,0.9);box-shadow:0 4px 18px rgba(0,0,0,0.25);
    pointer-events:none;
  }
  .result{margin-top:12px}
  .swatch{width:56px;height:56px;border-radius:8px;border:1px solid #ddd;display:inline-block;vertical-align:middle}
  .info{display:inline-block;vertical-align:middle;margin-left:10px}
  .meter{height:18px;background:#eef6ee;border-radius:12px;overflow:hidden;margin-top:8px;border:1px solid #e6f3e8}
  .meter-fill{height:100%;width:0%;background:linear-gradient(90deg,#ffd77a,#f07b3a);transition:width 900ms ease, background 400ms ease}
  .status{font-weight:700;margin-top:8px}
  .good{color:var(--good)}
  .bad{color:var(--bad)}
  .small{font-size:13px;color:#667085}
  .topbar{display:flex;justify-content:space-between;align-items:center;width:100%;max-width:720px;margin-bottom:12px}
  .lang{padding:8px;border-radius:8px}
  .download{margin-left:auto}
  @media(min-width:820px){ .layout{display:flex;gap:12px} .left{flex:1} .right{width:320px} }
</style>
</head>
<body>

<h1>üå± Smart Seed ‚Äî Moisture Detector</h1>

<div class="topbar">
  <div>
    <label for="seedSelect">Seed: </label>
    <select id="seedSelect" class="lang">
      <option value="paddy">Paddy</option>
      <option value="wheat">Wheat</option>
      <option value="maize">Maize</option>
      <option value="custom">Custom...</option>
    </select>
    <input id="customName" placeholder="Custom name" style="display:none;padding:8px;border-radius:8px;border:1px solid #ddd;margin-left:8px">
  </div>

  <div>
    <select id="lang" class="lang" title="Language">
      <option value="en">English</option>
      <option value="ml">Malayalam</option>
      <option value="hi">Hindi</option>
    </select>
    <button id="downloadReportBtn" class="btn-ghost download" title="Download last report">‚¨áÔ∏è Download</button>
  </div>
</div>

<div class="card layout" style="width:100%;max-width:980px">
  <div class="left">
    <div style="position:relative" class="overlayCircle">
      <video id="video" playsinline autoplay muted></video>
      <div class="guide" id="guide"></div>
    </div>

    <div style="margin-top:10px" class="controls">
      <button id="openCam" class="btn-primary">Open Camera</button>
      <button id="scanBtn" class="btn-primary">üì∏ Scan Color</button>
      <button id="resetBtn" class="btn-ghost">Reset</button>
    </div>

    <div class="small" style="margin-top:8px">Tip: place indicator strip near the center guide circle. Use diffused light, include a small white patch if possible.</div>
  </div>

  <div class="right" style="margin-left:12px">
    <div class="card" style="padding:12px">
      <div style="display:flex;align-items:center;gap:10px">
        <div id="swatch" class="swatch"></div>
        <div class="info">
          <div id="rgbText">R - G - B</div>
          <div id="hsvText" class="small"></div>
        </div>
      </div>

      <div class="result">
        <div class="small">Moisture status</div>
        <div id="statusText" class="status">Waiting for scan‚Ä¶</div>

        <div class="small" style="margin-top:10px">Germination prediction</div>
        <div class="meter"><div id="meterFill" class="meter-fill"></div></div>
        <div id="percentText" style="font-weight:700;margin-top:6px">-- %</div>

        <div id="adviceText" class="small" style="margin-top:8px">Advice will appear here.</div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
        <button id="saveBtn" class="btn-primary">Save Reading</button>
        <button id="speakBtn" class="btn-ghost">üîä Sound</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ---------- Setup & calibration values ---------- */
const seedSelect = document.getElementById('seedSelect');
const customName = document.getElementById('customName');
seedSelect.addEventListener('change', ()=> { customName.style.display = seedSelect.value==='custom' ? 'inline-block' : 'none'; });

// target "good" pink RGB (ideal moisture zone) - tweak after calibration if needed
const IDEAL_PINK = [200,100,140];

/* ---------- DOM ---------- */
const video = document.getElementById('video');
const canvas = document.createElement('canvas');
const swatch = document.getElementById('swatch');
const rgbText = document.getElementById('rgbText');
const hsvText = document.getElementById('hsvText');
const statusText = document.getElementById('statusText');
const adviceText = document.getElementById('adviceText');
const meterFill = document.getElementById('meterFill');
const percentText = document.getElementById('percentText');
const scanBtn = document.getElementById('scanBtn');
const openCam = document.getElementById('openCam');
const resetBtn = document.getElementById('resetBtn');
const saveBtn = document.getElementById('saveBtn');
const speakBtn = document.getElementById('speakBtn');
const langSelect = document.getElementById('lang');
const downloadReportBtn = document.getElementById('downloadReportBtn');

let stream = null;
let lastReport = null;

/* ---------- Language strings ---------- */
const MSG = {
  en:{
    waiting:'Waiting for scan‚Ä¶',
    dryTitle:'Too Dry ‚Äî BAD',
    dryDesc:'Seed quality dropping. Needs moisture conditioning.',
    goodTitle:'Ideal Moisture ‚Äî GOOD',
    goodDesc:'Best for storage & highest germination.',
    wetTitle:'Too Wet ‚Äî BAD',
    wetDesc:'Fungus risk! Dry seeds immediately.',
    unknownTitle:'Unknown color',
    unknownDesc:'Scan again with better lighting.',
    saved:'Saved to history',
    downloadNone:'No report to download'
  },
  ml:{
    waiting:'‡¥∏‡µç‡¥ï‡¥æ‡µª ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡µª ‡¥ï‡¥æ‡¥§‡µç‡¥§‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ‚Ä¶',
    dryTitle:'‡¥Æ‡¥ø‡¥ï‡µç‡¥ï‡¥µ‡¥æ‡¥±‡µÅ‡¥Ç ‡¥µ‡¥∞‡¥£‡µç‡¥ü‡¥§‡µç ‚Äî ‡¥Æ‡µã‡¥∂‡¥Ç',
    dryDesc:'‡¥¨‡µÄ‡¥ú ‡¥ó‡µÅ‡¥£‡¥®‡¥ø‡¥≤‡¥µ‡¥æ‡¥∞‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥§‡¥æ‡¥¥‡µç‡¥®‡µç‡¥®‡µÅ. ‡¥ö‡¥ø‡¥§‡¥±‡µÅ‡¥ï.',
    goodTitle:'‡¥∏‡¥∞‡µç‚Äç‡¥µ‡µç‡¥µ‡µã‡¥§‡µç‡¥§‡¥∞ ‡¥à‡µº‡¥™‡µç‡¥™‡¥Ç ‚Äî ‡¥®‡¥≤‡µç‡¥≤‡¥§‡µç',
    goodDesc:'‡¥∏‡¥Ç‡¥≠‡¥∞‡¥£‡¥§‡µç‡¥§‡¥ø‡¥®‡µç ÿ®€Åÿ™ÿ±; ‡¥â‡¥Ø‡µº‡¥®‡µç‡¥® ‡¥Æ‡µÅ‡¥≥‡¥µ‡µΩ.',
    wetTitle:'‡¥Ö‡¥§‡¥ø‡¥®‡¥æ‡¥Ø‡¥§‡µÅ‡¥Ç ‡¥à‡µº‡¥™‡µç‡¥™‡¥Ç ‚Äî ‡¥Æ‡µã‡¥∂‡¥Ç',
    wetDesc:'‡¥´‡¥Ç‡¥ó‡¥∏‡µç ‡¥∏‡¥æ‡¥ß‡µç‡¥Ø‡¥§! ‡¥â‡¥ü‡µª ‡¥â‡¥£‡¥ï‡µç‡¥ï‡µÅ‡¥ï.',
    unknownTitle:'‡¥Ö‡¥±‡¥ø‡¥Ø‡¥æ‡¥®‡¥æ‡¥Ø‡¥ø‡¥≤‡µç‡¥≤',
    unknownDesc:'‡¥â‡¥Ø‡µº‡¥®‡µç‡¥®‡¥Æ‡¥®‡¥Æ‡µÅ‡¥≥‡µç‡¥≥ ‡¥™‡µç‡¥∞‡¥ï‡¥æ‡¥∂‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥µ‡µÄ‡¥£‡µç‡¥ü‡µÅ‡¥Ç ‡¥∏‡µç‡¥ï‡¥æ‡µª ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï.',
    saved:'‡¥ö‡¥∞‡¥ø‡¥§‡µç‡¥∞‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥∏‡¥Ç‡¥∞‡¥ï‡µç‡¥∑‡¥ø‡¥ö‡µç‡¥ö‡µÅ',
    downloadNone:'‡¥°‡µó‡µ∫‡¥≤‡µã‡¥°‡¥ø‡¥®‡µÅ ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µç ‡¥á‡¥≤‡µç‡¥≤'
  },
  hi:{
    waiting:'‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§æ ‡§á‡§Ç‡§§‡§ú‡§æ‡§∞‚Ä¶',
    dryTitle:'‡§¨‡§π‡•Å‡§§ ‡§∏‡•Ç‡§ñ‡§æ ‚Äî ‡§ñ‡§∞‡§æ‡§¨',
    dryDesc:'‡§¨‡•Ä‡§ú ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§ó‡§ø‡§∞ ‡§∞‡§π‡•Ä ‡§π‡•à‡•§ ‡§®‡§Æ‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è‡•§',
    goodTitle:'‡§â‡§ö‡§ø‡§§ ‡§®‡§Æ‡•Ä ‚Äî ‡§Ö‡§ö‡•ç‡§õ‡§æ',
    goodDesc:'‡§≠‡§Ç‡§°‡§æ‡§∞‡§£ ‡§µ ‡§Ö‡§Ç‡§ï‡•Å‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§§‡•ç‡§§‡§Æ‡•§',
    wetTitle:'‡§¨‡§π‡•Å‡§§ ‡§ó‡•Ä‡§≤‡§æ ‚Äî ‡§ñ‡§∞‡§æ‡§¨',
    wetDesc:'‡§´‡§´‡•Ç‡§Ç‡§¶‡•Ä ‡§ï‡§æ ‡§ñ‡§§‡§∞‡§æ! ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§∏‡•Å‡§ñ‡§æ‡§è‡§Ç‡•§',
    unknownTitle:'‡§∞‡§Ç‡§ó ‡§Ö‡§ú‡•ç‡§û‡§æ‡§§',
    unknownDesc:'‡§¨‡•á‡§π‡§§‡§∞ ‡§∞‡•ã‡§∂‡§®‡•Ä ‡§Æ‡•á‡§Ç ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡•á‡§Ç‡•§',
    saved:'‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§Æ‡•á‡§Ç ‡§∏‡§π‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ',
    downloadNone:'‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç'
  }
};
function t(k){ const L = langSelect.value || 'en'; return MSG[L][k] || k; }

/* ---------- Sound alert (beep) ---------- */
function playBeep(f=900, tms=220){
  try{
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = 'sine';
    o.frequency.value = f;
    o.connect(g); g.connect(ctx.destination);
    o.start();
    g.gain.setValueAtTime(0.0001, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime + 0.02);
    setTimeout(()=>{ g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.02); o.stop(ctx.currentTime + 0.04); ctx.close(); }, tms);
  }catch(e){ console.warn('beep failed', e); }
}

/* ---------- Camera open (simple) ---------- */
openCam.addEventListener('click', async ()=>{
  if(stream) return;
  try{
    stream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode:'environment' }});
    video.srcObject = stream;
    await video.play();
  }catch(e){
    alert('Camera permission denied or not available. Try another browser.');
    console.error(e);
  }
});

/* ---------- Scan / Capture ---------- */
scanBtn.addEventListener('click', ()=> performScan());

async function performScan(){
  if(!stream){ alert('Open camera first'); return; }
  // crop center area same size as guide
  const vw = video.videoWidth, vh = video.videoHeight;
  if(!vw || !vh){ alert('Camera not ready'); return; }
  // set canvas to small crop for speed
  const cropW = Math.floor(vw * 0.2);
  const cropH = Math.floor(vh * 0.2);
  const sx = Math.floor((vw - cropW)/2);
  const sy = Math.floor((vh - cropH)/2);
  canvas.width = cropW; canvas.height = cropH;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, sx, sy, cropW, cropH, 0,0,cropW,cropH);
  // average sample
  const data = ctx.getImageData(0,0,cropW,cropH).data;
  let r=0,g=0,b=0,count=0;
  const step = 4;
  for(let i=0;i<data.length;i+=4*step){
    r += data[i]; g += data[i+1]; b += data[i+2]; count++;
  }
  r = Math.round(r/count); g = Math.round(g/count); b = Math.round(b/count);
  // update UI
  swatch.style.background = `rgb(${r},${g},${b})`;
  rgbText.innerText = `R ${r} ‚Ä¢ G ${g} ‚Ä¢ B ${b}`;
  const hsv = rgbToHsv(r,g,b);
  hsvText.innerText = `H ${Math.round(hsv[0])}¬∞ ‚Ä¢ S ${Math.round(hsv[1]*100)}% ‚Ä¢ V ${Math.round(hsv[2]*100)}%`;
  // detect zone (we use your required mapping)
  const zone = detectZone(r,g,b);
  // compute germination % prediction
  const germ = computeGerminationPercent(r,g,b,zone);
  // update meter and text
  updateMeter(germ, zone);
  // show status/advice
  showStatus(zone, germ);
  // prepare lastReport
  lastReport = {
    seed: seedSelect.value === 'custom' && customName.value.trim() ? customName.value.trim() : seedSelect.value,
    rgb:[r,g,b], hsv, zone, germination_percent: germ, timestamp: new Date().toISOString(),
    lang: langSelect.value || 'en'
  };
  // play sound if bad
  if(zone === 'dry' || zone === 'wet'){ playBeep(700,220); setTimeout(()=>playBeep(700,180),280); }
}

/* ---------- Detect zone (purple dry / pink good / blue/green wet) ---------- */
function detectZone(r,g,b){
  // heuristic thresholds tuned for anthocyanin-like colours
  // Purple/Violet: r moderate-low, b high -> dry (bad)
  if((b - r) > 40 && b > 110) return 'dry';
  // Pink/light red: r high, g moderate-low, b moderate -> good
  if(r > 160 && g < 140 && b < 160) return 'good';
  // Blue/green: b or g dominant -> wet
  if(b > 150 || g > 150) return 'wet';
  // fallback: decide by closeness to ideal pink
  const dPink = colorDistance([r,g,b], IDEAL_PINK);
  if(dPink < 60) return 'good';
  return 'unknown';
}

/* ---------- Germination percent mapping ---------- */
function computeGerminationPercent(r,g,b,zone){
  // base closeness to ideal pink (lower distance => better)
  const d = colorDistance([r,g,b], IDEAL_PINK);
  let base = Math.round(Math.max(0, 100 - d)); // 0..100
  // adjust depending on zone: good keeps base, dry reduces, wet reduces more
  if(zone === 'good') base = clamp(base, 60, 98);
  else if(zone === 'dry') base = clamp(Math.round(base * 0.55), 20, 70);
  else if(zone === 'wet') base = clamp(Math.round(base * 0.45), 15, 65);
  else base = clamp(Math.round(base * 0.6), 20, 85);
  return base;
}

/* ---------- UI updates ---------- */
function updateMeter(percent, zone){
  percentText.innerText = `${percent} %`;
  meterFill.style.width = percent + '%';
  if(zone === 'good') meterFill.style.background = 'linear-gradient(90deg,#8ef07a,#1e7f3f)';
  else if(zone === 'dry') meterFill.style.background = 'linear-gradient(90deg,#ffb677,#ff6b6b)';
  else if(zone === 'wet') meterFill.style.background = 'linear-gradient(90deg,#7ab9ff,#3b82f6)';
  else meterFill.style.background = 'linear-gradient(90deg,#ddd,#aaa)';
}

/* ---------- Show text & advice ---------- */
function showStatus(zone, percent){
  const L = langSelect.value || 'en';
  if(zone === 'dry'){
    statusText.innerText = t('dryTitle'); statusText.className = 'status bad';
    adviceText.innerText = t('dryDesc');
  } else if(zone === 'good'){
    statusText.innerText = t('goodTitle'); statusText.className = 'status good';
    adviceText.innerText = t('goodDesc');
  } else if(zone === 'wet'){
    statusText.innerText = t('wetTitle'); statusText.className = 'status bad';
    adviceText.innerText = t('wetDesc');
  } else {
    statusText.innerText = t('unknownTitle'); statusText.className = 'status';
    adviceText.innerText = t('unknownDesc');
  }
}

/* ---------- Save & download ---------- */
saveBtn.addEventListener('click', ()=> {
  if(!lastReport){ alert('No reading to save'); return; }
  const all = JSON.parse(localStorage.getItem('ss-readings')||'[]');
  all.unshift(lastReport);
  localStorage.setItem('ss-readings', JSON.stringify(all.slice(0,100)));
  alert(t('saved'));
  renderHistory();
});

downloadReportBtn.addEventListener('click', ()=> {
  if(!lastReport){ alert(t('downloadNone')); return; }
  downloadJSON(lastReport, `seed-report-${lastReport.seed}-${(new Date()).toISOString().slice(0,19)}.json`);
});

/* ---------- Speak button plays short voice of status (simple) ---------- */
speakBtn.addEventListener('click', ()=> {
  if(!lastReport){ alert('No reading'); return; }
  const msg = (lastReport.zone === 'good') ? t('goodTitle') : (lastReport.zone === 'dry' ? t('dryTitle') : (lastReport.zone === 'wet' ? t('wetTitle') : t('unknownTitle')));
  speakText(msg);
});

/* ---------- Small helpers ---------- */
function clamp(v,a,z){ return Math.max(a,Math.min(z,v)); }
function colorDistance(a,b){ const dr=a[0]-b[0], dg=a[1]-b[1], db=a[2]-b[2]; return Math.sqrt(dr*dr+dg*dg+db*db); }
function rgbToHsv(r,g,b){ r/=255;g/=255;b/=255; const max=Math.max(r,g,b), min=Math.min(r,g,b); let h=0,s=0,v=max; const d=max-min; s=max===0?0:d/max; if(max!==min){ switch(max){ case r: h=(g-b)/d + (g<b?6:0); break; case g: h=(b-r)/d + 2; break; case b: h=(r-g)/d + 4; break; } h/=6; h*=360;} return [h,s,v]; }
function downloadJSON(obj, filename){ const blob=new Blob([JSON.stringify(obj,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }
function speakText(text){ if('speechSynthesis' in window){ const u=new SpeechSynthesisUtterance(text); u.lang = langSelect.value==='ml' ? 'ml-IN' : (langSelect.value==='hi' ? 'hi-IN' : 'en-US'); speechSynthesis.speak(u); } }

/* ---------- Render history list ---------- */
function renderHistory(){
  const all = JSON.parse(localStorage.getItem('ss-readings')||'[]');
  historyHTML = '';
  historyEl.innerHTML = '';
  all.forEach(r=>{
    const el = document.createElement('div');
    el.style.padding='8px'; el.style.borderBottom='1px solid #eee';
    el.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>${r.seed}</strong><div class="small">${new Date(r.timestamp).toLocaleString()}</div></div><div style="text-align:right"><div>${r.germination_percent}%</div><div class="small">${r.zone}</div></div></div>`;
    el.addEventListener('click', ()=> { lastReport = r; updateMeter(r.germination_percent, r.zone); showStatus(r.zone, r.germination_percent); swatch.style.background = `rgb(${r.rgb[0]},${r.rgb[1]},${r.rgb[2]})`; });
    historyEl.appendChild(el);
  });
}

/* ---------- i18n translations for new keys ---------- */
const MSG_EXTRA = {
  en:{ dryTitle:'Too Dry ‚Äî BAD', dryDesc:'Seed quality dropping. Needs moisture conditioning.', goodTitle:'Ideal Moisture ‚Äî GOOD', goodDesc:'Best for storage & highest germination.', wetTitle:'Too Wet ‚Äî BAD', wetDesc:'Fungus risk! Dry seeds immediately.', unknownTitle:'Unknown color', unknownDesc:'Scan again with better lighting.', saved:'Saved', downloadNone:'No report' },
  ml:{ dryTitle:'‡¥Æ‡¥ø‡¥ï‡µç‡¥ï‡¥µ‡¥æ‡¥±‡µÅ‡¥Ç ‡¥µ‡¥∞‡¥£‡µç‡¥ü‡¥§‡µç ‚Äî ‡¥Æ‡µã‡¥∂‡¥Ç', dryDesc:'‡¥¨‡µÄ‡¥ú ‡¥ó‡µÅ‡¥£‡¥®‡¥ø‡¥≤‡¥µ‡¥æ‡¥∞‡¥Ç ‡¥ï‡µÅ‡¥±‡¥û‡µç‡¥û‡¥ø‡¥ü‡µç‡¥ü‡µÅ‡¥£‡µç‡¥ü‡µÅ. ‡¥®‡¥®‡¥ï‡µç‡¥ï‡µΩ ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥£‡¥Ç.', goodTitle:'‡¥á‡¥ü‡¥§‡µç‡¥§‡¥∞‡¥Ç ‡¥à‡µº‡¥™‡µç‡¥™‡µç ‚Äî ‡¥®‡¥≤‡µç‡¥≤‡¥§‡µç', goodDesc:'‡¥∏‡¥Ç‡¥≠‡¥∞‡¥£‡¥§‡µç‡¥§‡¥ø‡¥®‡µÅ‡¥Ç ‡¥Æ‡µÅ‡¥≥‡¥§‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥â‡¥§‡µç‡¥§‡¥Æ‡¥Ç.', wetTitle:'‡¥Ö‡¥§‡¥ø ‡¥à‡µº‡¥™‡µç‡¥™‡¥Ç ‚Äî ‡¥Æ‡µã‡¥∂‡¥Ç', wetDesc:'‡¥´‡¥Ç‡¥ó‡¥∏‡µç ‡¥∏‡¥æ‡¥ß‡µç‡¥Ø‡¥§! ‡¥â‡¥ü‡µª ‡¥â‡¥£‡¥ï‡µç‡¥ï‡µÅ‡¥ï.', unknownTitle:'‡¥Ö‡¥±‡¥ø‡¥Ø‡¥æ‡¥®‡¥æ‡¥Ø‡¥ø‡¥≤‡µç‡¥≤', unknownDesc:'‡¥®‡¥≤‡µç‡¥≤ ‡¥™‡µç‡¥∞‡¥ï‡¥æ‡¥∂‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥µ‡µÄ‡¥£‡µç‡¥ü‡µÅ‡¥Ç ‡¥∏‡µç‡¥ï‡¥æ‡µª ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï.', saved:'‡¥∏‡¥Ç‡¥∞‡¥ï‡µç‡¥∑‡¥ø‡¥ö‡µç‡¥ö‡µÅ', downloadNone:'‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µç ‡¥á‡¥≤‡µç‡¥≤' },
  hi:{ dryTitle:'‡§¨‡§π‡•Å‡§§ ‡§∏‡•Ç‡§ñ‡§æ ‚Äî ‡§ñ‡§∞‡§æ‡§¨', dryDesc:'‡§¨‡•Ä‡§ú ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§ó‡§ø‡§∞ ‡§∞‡§π‡•Ä ‡§π‡•à‡•§ ‡§®‡§Æ‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è‡•§', goodTitle:'‡§â‡§ö‡§ø‡§§ ‡§®‡§Æ‡•Ä ‚Äî ‡§Ö‡§ö‡•ç‡§õ‡§æ', goodDesc:'‡§≠‡§Ç‡§°‡§æ‡§∞‡§£ ‡§µ ‡§Ö‡§Ç‡§ï‡•Å‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§§‡•ç‡§§‡§Æ‡•§', wetTitle:'‡§¨‡§π‡•Å‡§§ ‡§ó‡•Ä‡§≤‡§æ ‚Äî ‡§ñ‡§∞‡§æ‡§¨', wetDesc:'‡§´‡§´‡•Ç‡§Ç‡§¶‡•Ä ‡§ï‡§æ ‡§ñ‡§§‡§∞‡§æ! ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§∏‡•Å‡§ñ‡§æ‡§è‡§Ç‡•§', unknownTitle:'‡§∞‡§Ç‡§ó ‡§Ö‡§ú‡•ç‡§û‡§æ‡§§', unknownDesc:'‡§¨‡•á‡§π‡§§‡§∞ ‡§∞‡•ã‡§∂‡§®‡•Ä ‡§Æ‡•á‡§Ç ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡•á‡§Ç‡•§', saved:'‡§∏‡§π‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ', downloadNone:'‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç' }
};
function t(k){ return MSG_EXTRA[langSelect.value || 'en'][k] || k; }

/* ---------- Reset ---------- */
resetBtn.addEventListener('click', ()=> { clearAll(); });

function clearAll(){
  lastReport = null;
  swatch.style.background = '#fff';
  rgbText.innerText = 'R - G - B';
  hsvText.innerText = '';
  statusText.innerText = t('waiting');
  percentText.innerText = '-- %';
  meterFill.style.width = '0%';
  adviceText.innerText = '';
}

/* ---------- init ---------- */
clearAll();
renderHistory();

</script>
</body>
</html>