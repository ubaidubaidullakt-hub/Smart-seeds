<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Smart Seed â€” Moisture Analyzer (22 languages)</title>
<style>
  :root{
    --bg:#f4f7f6; --card:#fff; --accent:#166f3a; --muted:#42514a; --danger:#c63c3c;
    --good:#178a45;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--muted)}
  .wrap{max-width:1100px;margin:14px auto;padding:14px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#6ecb88);display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:20px}
  h1{margin:0;font-size:18px;color:var(--accent)}
  .subtitle{font-size:13px;color:var(--muted)}
  .grid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:14px}
  @media(min-width:980px){.grid{grid-template-columns:1fr 380px}}
  .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 10px 28px rgba(2,6,23,0.06)}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  select,input,button{padding:10px 12px;border-radius:10px;border:1px solid #e6eef0;background:transparent;font-size:14px}
  button.primary{background:var(--accent);color:#fff;border:none;cursor:pointer}
  button.ghost{background:transparent;border:1px dashed #dfeaea;cursor:pointer}
  .video-frame{position:relative;border-radius:10px;overflow:hidden;background:#000;height:340px}
  video{width:100%;height:100%;display:block;object-fit:cover}
  .guide{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:110px;height:110px;border-radius:50%;border:3px dashed rgba(255,255,255,0.9);pointer-events:none}
  .preview{display:flex;gap:12px;align-items:center;margin-top:10px}
  .swatch{width:68px;height:68px;border-radius:12px;border:1px solid #e9f1ee;box-shadow:inset 0 2px 6px rgba(255,255,255,0.6)}
  .metrics{font-size:13px;color:var(--muted)}
  .meter{height:20px;background:#eef9ee;border-radius:12px;overflow:hidden;margin-top:8px;border:1px solid rgba(0,0,0,0.03)}
  .meter-fill{height:100%;width:0%;background:linear-gradient(90deg,#ff8fa0,#ff5b5b);transition:width 900ms cubic-bezier(.2,.9,.2,1)}
  .badge{display:inline-block;padding:8px 12px;border-radius:999px;font-weight:700}
  .status-low{background:#fff5f5;color:var(--danger);border:1px solid #f7d6d6}
  .status-opt{background:#f3fff6;color:var(--good);border:1px solid #d4efd4}
  .status-high{background:#f2f8ff;color:#0b62a3;border:1px solid #d8e9fb}
  .small{font-size:13px;color:var(--muted)}
  .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .history{max-height:220px;overflow:auto;margin-top:8px}
  .hist-item{padding:8px;border-radius:8px;border:1px solid #eef6f1;margin-bottom:8px;background:linear-gradient(180deg,rgba(255,255,255,0.6),transparent)}
  footer{font-size:13px;color:var(--muted);text-align:center;margin-top:12px}
  .legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .legend .item{display:flex;gap:8px;align-items:center}
  .colorbox{width:20px;height:20px;border-radius:4px;border:1px solid rgba(0,0,0,0.06)}
  .note{font-size:13px;color:var(--muted);margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo">SS</div>
      <div>
        <h1>Smart Seed â€” Moisture Analyzer</h1>
        <div class="subtitle small">Rear-camera color check â€¢ Multilingual â€¢ Farmer report</div>
      </div>
    </div>

    <div class="controls">
      <select id="langSelect" title="Language"></select>
      <button id="enableAudio" class="ghost">Enable Audio</button>
    </div>
  </header>

  <div class="grid">
    <!-- Left: camera + controls -->
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="display:flex;gap:10px;align-items:center">
          <label class="small">Seed</label>
          <select id="seedSelect">
            <!-- 20 seeds + custom -->
            <option value="paddy">Paddy (Rice)</option><option value="wheat">Wheat</option><option value="ragi">Ragi</option>
            <option value="green_gram">Green Gram</option><option value="black_gram">Black Gram</option><option value="bengal_gram">Bengal Gram</option>
            <option value="maize">Maize</option><option value="coconut">Coconut</option><option value="groundnut">Groundnut</option>
            <option value="sesame">Sesame</option><option value="mustard">Mustard</option><option value="sorghum">Sorghum</option>
            <option value="foxtail">Foxtail</option><option value="barnyard">Barnyard</option><option value="little_millet">Little Millet</option>
            <option value="pearl_millet">Pearl Millet</option><option value="soybean">Soybean</option><option value="sunflower">Sunflower</option>
            <option value="cotton">Cotton</option><option value="custom">Custom (calibrate)</option>
          </select>
          <input id="customName" placeholder="Custom name" style="display:none" />
        </div>

        <div style="display:flex;gap:8px">
          <button id="openCam" class="primary">Open Rear Camera</button>
          <button id="scanBtn" class="primary">ðŸ“¸ Scan Now</button>
          <button id="resetBtn" class="ghost">Reset</button>
        </div>
      </div>

      <div style="margin-top:12px" class="video-wrap">
        <div class="video-frame">
          <video id="video" playsinline autoplay muted></video>
          <div class="guide" aria-hidden="true"></div>
        </div>

        <div class="preview">
          <div id="swatch" class="swatch"></div>
          <div>
            <div id="rgbText" class="metrics">R - G - B</div>
            <div id="hsvText" class="metrics small"></div>
          </div>
        </div>

        <div class="legend">
          <div class="item"><div class="colorbox" style="background:purple"></div><div class="small">Too Dry (Purple/Violet)</div></div>
          <div class="item"><div class="colorbox" style="background:pink"></div><div class="small">Ideal (Pink/Light Red)</div></div>
          <div class="item"><div class="colorbox" style="background:green"></div><div class="small">Too Wet (Green)</div></div>
          <div class="item"><div class="colorbox" style="background:blue"></div><div class="small">Very Wet (Blue)</div></div>
        </div>

        <div class="note small">Tip: include a small white patch near the strip to improve color accuracy.</div>
      </div>

      <div style="margin-top:12px" class="actions">
        <button id="calibrateBtn" class="ghost">Calibrate Ideal</button>
        <button id="downloadBtn" class="ghost">Download Report</button>
      </div>
    </div>

    <!-- Right: Results & history -->
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small">Detected</div>
          <div id="detectedState" style="font-weight:800;font-size:18px">No sample</div>
        </div>
        <div style="text-align:right">
          <div class="small">Confidence</div>
          <div id="confidence" style="font-weight:800">--%</div>
        </div>
      </div>

      <div style="margin-top:12px">
        <div class="small">Moisture status</div>
        <div id="statusBadgeWrap" style="margin-top:8px"><span id="statusBadge" class="badge status-opt">--</span></div>

        <div style="margin-top:14px" class="small">Germination estimate</div>
        <div class="meter"><div id="meterFill" class="meter-fill" style="width:0%"></div></div>
        <div id="scoreText" style="margin-top:8px;font-weight:700">-- / 100</div>

        <div id="adviceText" class="small" style="margin-top:10px;color:var(--muted)">Capture the packet color strip to get farmer-friendly advice.</div>

        <div style="margin-top:12px">
          <button id="saveBtn" class="primary">Save to history</button>
          <button id="speakBtn" class="ghost">ðŸ”Š Voice</button>
        </div>

        <div style="margin-top:12px">
          <div class="small">History</div>
          <div id="historyList" class="history"></div>
        </div>
      </div>
    </div>
  </div>

  <footer>Made for YIP â€¢ Works on mobile â€” allow camera & audio permissions</footer>
</div>

<script>
/* ------------------- 22 LANGUAGES: UI & STATUS STRINGS -------------------
   For each language code (22 official), provide translations for:
   - tip / openCameraErr / audioEnabled / tooDryTitle / tooDryDesc /
   idealTitle / idealDesc / tooWetTitle / tooWetDesc / unknownTitle /
   saved / noReport / downloadLabel / calibrateLabel, etc.
   We'll provide full strings for English (en), Malayalam (ml), Hindi (hi)
   and status strings for the other scheduled languages (translated).
*/
const LANGS = [
  {code:'en',name:'English'},
  {code:'ml',name:'Malayalam'},
  {code:'hi',name:'Hindi'},
  {code:'as',name:'Assamese'},
  {code:'bn',name:'Bengali'},
  {code:'brx',name:'Bodo'},
  {code:'doi',name:'Dogri'},
  {code:'gu',name:'Gujarati'},
  {code:'kn',name:'Kannada'},
  {code:'ks',name:'Kashmiri'},
  {code:'kok',name:'Konkani'},
  {code:'mai',name:'Maithili'},
  {code:'mni',name:'Manipuri'},
  {code:'mr',name:'Marathi'},
  {code:'ne',name:'Nepali'},
  {code:'od',name:'Odia'},
  {code:'pa',name:'Punjabi'},
  {code:'sa',name:'Sanskrit'},
  {code:'sat',name:'Santali'},
  {code:'sd',name:'Sindhi'},
  {code:'ta',name:'Tamil'},
  {code:'te',name:'Telugu'}
];

const STRINGS = {
  en:{
    tip:'Place a small white patch near the strip for consistent reading.',
    openCameraErr:'Cannot open camera. Allow permission and try again.',
    audioEnabled:'Audio enabled',
    tooDryTitle:'Too Dry â€” BAD',
    tooDryDesc:'Very low moisture. Seeds may lose germination â€” moistening advised.',
    idealTitle:'Ideal Moisture â€” GOOD',
    idealDesc:'Perfect moisture for storage and best germination.',
    tooWetTitle:'Too Wet â€” BAD',
    tooWetDesc:'High moisture â€” fungus risk and quality loss. Dry before storage.',
    unknownTitle:'Unknown â€” try better lighting',
    saved:'Saved to history',
    noReport:'No reading to download',
    download:'Download Report',
    calibrate:'Calibrate Ideal'
  },
  ml:{
    tip:'à´¸àµà´Ÿàµà´°à´¿à´ªàµà´ªàµ à´…à´Ÿàµà´¤àµà´¤àµ à´’à´°àµ à´šàµ†à´±àµ à´µàµ†à´³àµà´¤àµà´¤ à´ªà´¾à´šàµà´šàµ à´µàµ†à´•àµà´•àµà´•.',
    openCameraErr:'à´•àµà´¯à´¾à´®à´± à´¤àµà´±à´•àµà´•à´¾àµ» à´¸à´¾à´§à´¿à´šàµà´šà´¿à´²àµà´². à´…à´¨àµà´®à´¤à´¿à´•à´³àµâ€ à´ªàµà´°à´µàµ¼à´¤àµà´¤à´¿à´•àµà´•àµà´¨àµà´¨àµà´µàµ†à´¨àµà´¨àµ à´ªà´°à´¿à´¶àµ‹à´§à´¿à´•àµà´•àµà´•.',
    audioEnabled:'à´“à´¡à´¿à´¯àµ‹ à´ªàµà´°à´µàµ¼à´¤àµà´¤à´¿à´•àµà´•àµà´¨àµà´¨àµ',
    tooDryTitle:'à´µà´³à´°àµ† à´µà´°à´£àµà´Ÿà´¤àµ â€” à´®àµ‹à´¶à´‚',
    tooDryDesc:'à´µà´³à´°àµ† à´•àµà´±à´µàµ à´ˆàµ¼à´ªàµà´ªà´‚. à´µà´¿à´¤àµà´¤àµà´•à´³àµà´Ÿàµ† à´®àµà´³à´šàµà´šàµà´µà´°àµ½ à´•àµà´±à´¯à´¾à´‚ â€” à´¨à´¨àµà´¨à´¾à´¯à´¿ à´ˆàµ¼à´ªàµà´ªà´‚ à´¨àµ½à´•àµà´•.',
    idealTitle:'à´‰à´¤àµà´¤à´® à´ˆàµ¼à´ªàµà´ªàµ â€” à´¨à´²àµà´²à´¤àµ',
    idealDesc:'à´¸à´‚à´­à´°à´£à´¤àµà´¤à´¿à´¨àµà´‚ à´®à´¿à´•à´šàµà´š à´®àµà´³à´šàµà´šàµà´µà´°à´²à´¿à´¨àµà´‚ à´…à´¨àµà´¯àµ‹à´œàµà´¯à´‚.',
    tooWetTitle:'à´µà´³à´°àµ† à´ˆàµ¼à´ªàµà´ªà´‚ â€” à´®àµ‹à´¶à´‚',
    tooWetDesc:'à´à´±àµà´±à´µàµà´‚ à´•àµ‚à´Ÿàµà´¤àµ½ à´ˆàµ¼à´ªàµà´ªà´‚ â€” à´«à´‚à´—à´¸àµ à´¸à´¾à´§àµà´¯à´¤, à´—àµà´£à´¨à´¿à´²à´µà´¾à´° à´¨à´·àµà´Ÿà´‚. à´‰à´£à´•àµà´•àµà´•.',
    unknownTitle:'à´…à´¸àµà´ªà´·àµà´Ÿà´‚ â€” à´®à´¿à´•à´šàµà´š à´ªàµà´°à´•à´¾à´¶à´¤àµà´¤à´¿àµ½ à´¶àµà´°à´®à´¿à´•àµà´•àµà´•',
    saved:'à´šà´°à´¿à´¤àµà´°à´¤àµà´¤à´¿àµ½ à´¸à´‚à´°à´•àµà´·à´¿à´šàµà´šàµ',
    noReport:'à´¡àµ—àµºà´²àµ‹à´¡àµ à´šàµ†à´¯àµà´¯à´¾à´¨àµà´³àµà´³ à´±àµ€à´¡à´¿à´‚à´—àµ à´‡à´²àµà´²',
    download:'à´±à´¿à´ªàµà´ªàµ‹àµ¼à´Ÿàµà´Ÿàµ à´¡àµ—àµºà´²àµ‹à´¡àµ',
    calibrate:'à´†à´¦àµ¼à´¶ calibrate à´šàµ†à´¯àµà´¯àµà´•'
  },
  hi:{
    tip:'à¤‡à¤‚à¤¡à¤¿à¤•à¥‡à¤Ÿà¤° à¤¸à¥à¤Ÿà¥à¤°à¤¿à¤ª à¤•à¥‡ à¤ªà¤¾à¤¸ à¤à¤• à¤›à¥‹à¤Ÿà¤¾ à¤¸à¤«à¥‡à¤¦ à¤ªà¥ˆà¤š à¤°à¤–à¥‡à¤‚à¥¤',
    openCameraErr:'à¤•à¥ˆà¤®à¤°à¤¾ à¤–à¥‹à¤²à¤¨à¥‡ à¤®à¥‡à¤‚ à¤¸à¤®à¤¸à¥à¤¯à¤¾à¥¤ à¤…à¤¨à¥à¤®à¤¤à¤¿ à¤¦à¥‡à¤‚ à¤”à¤° à¤ªà¥à¤¨à¤ƒ à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚à¥¤',
    audioEnabled:'à¤‘à¤¡à¤¿à¤¯à¥‹ à¤¸à¤•à¥à¤·à¤® à¤¹à¥ˆ',
    tooDryTitle:'à¤¬à¤¹à¥à¤¤ à¤¸à¥‚à¤–à¤¾ â€” à¤–à¤°à¤¾à¤¬',
    tooDryDesc:'à¤¨à¤®à¥€ à¤¬à¤¹à¥à¤¤ à¤•à¤®à¥¤ à¤¬à¥€à¤œà¥‹à¤‚ à¤•à¥€ à¤…à¤‚à¤•à¥à¤°à¤£ à¤•à¥à¤·à¤®à¤¤à¤¾ à¤•à¤® à¤¹à¥‹ à¤¸à¤•à¤¤à¥€ à¤¹à¥ˆ â€” à¤¹à¤²à¥à¤•à¥€ à¤¨à¤®à¥€ à¤¦à¥‡à¤‚à¥¤',
    idealTitle:'à¤‰à¤¤à¥à¤¤à¤® à¤¨à¤®à¥€ â€” à¤…à¤šà¥à¤›à¤¾',
    idealDesc:'à¤­à¤‚à¤¡à¤¾à¤°à¤£ à¤”à¤° à¤…à¤‚à¤•à¥à¤°à¤£ à¤•à¥‡ à¤²à¤¿à¤ à¤‰à¤ªà¤¯à¥à¤•à¥à¤¤ à¤¨à¤®à¥€à¥¤',
    tooWetTitle:'à¤¬à¤¹à¥à¤¤ à¤—à¥€à¤²à¤¾ â€” à¤–à¤°à¤¾à¤¬',
    tooWetDesc:'à¤…à¤§à¤¿à¤• à¤¨à¤®à¥€ â€” à¤«à¤«à¥‚à¤‚à¤¦à¥€ à¤•à¤¾ à¤–à¤¤à¤°à¤¾ à¤”à¤° à¤—à¥à¤£à¤µà¤¤à¥à¤¤à¤¾ à¤¹à¤¾à¤¨à¤¿à¥¤ à¤ªà¤¹à¤²à¥‡ à¤¸à¥à¤–à¤¾à¤à¤à¥¤',
    unknownTitle:'à¤…à¤¸à¥à¤ªà¤·à¥à¤Ÿ â€” à¤¬à¥‡à¤¹à¤¤à¤° à¤ªà¥à¤°à¤•à¤¾à¤¶ à¤®à¥‡à¤‚ à¤¸à¥à¤•à¥ˆà¤¨ à¤•à¤°à¥‡à¤‚',
    saved:'à¤‡à¤¤à¤¿à¤¹à¤¾à¤¸ à¤®à¥‡à¤‚ à¤¸à¤¹à¥‡à¤œà¤¾ à¤—à¤¯à¤¾',
    noReport:'à¤¡à¤¾à¤‰à¤¨à¤²à¥‹à¤¡ à¤•à¥‡ à¤²à¤¿à¤ à¤•à¥‹à¤ˆ à¤°à¥€à¤¡à¤¿à¤‚à¤— à¤¨à¤¹à¥€à¤‚',
    download:'à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿ à¤¡à¤¾à¤‰à¤¨à¤²à¥‹à¤¡',
    calibrate:'à¤†à¤¦à¤°à¥à¤¶ à¤•à¥ˆà¤²à¤¿à¤¬à¥à¤°à¥‡à¤Ÿ à¤•à¤°à¥‡à¤‚'
  },
  /* For other scheduled languages we include translated status strings.
     (These are concise status translations.) */
  as:{ tooDryTitle:'à¦…à¦¤à¦¿ à¦¶à§à¦•à¦¾à¦¨ â€” à¦•à§à¦·à¦¤à¦¿à¦•à¦¾à¦°à¦•', tooDryDesc:'à¦¬à§€à¦œà§‡à¦° à¦†à¦°à§à¦¦à§à¦°à¦¤à¦¾ à¦–à§à¦¬à¦‡ à¦•à¦®à¥¤ à¦—à§à¦£à¦®à¦¾à¦¨ à¦¹à§à¦°à¦¾à¦¸à§‡à¦° à¦¸à¦®à§à¦­à¦¾à¦¬à¦¨à¦¾à¥¤', idealTitle:'à¦‰à¦ªà¦¯à§à¦•à§à¦¤ à¦†à¦°à§à¦¦à§à¦°à¦¤à¦¾ â€” à¦­à¦¾à¦²', idealDesc:'à¦¸à¦‚à¦°à¦•à§à¦·à¦£ à¦“ à¦¬à¦ªà¦¨à§‡à¦° à¦œà¦¨à§à¦¯ à¦‰à¦ªà¦¯à§à¦•à§à¦¤à¥¤', tooWetTitle:'à¦…à¦¤à¦¿ à¦­à¦¿à¦œà¦¾ â€” à¦•à§à¦·à¦¤à¦¿à¦•à¦¾à¦°à¦•', tooWetDesc:'à¦›à¦¾à¦à¦šà§‡à¦° à¦à§à¦à¦•à¦¿, à¦—à§à¦£à¦®à¦¾à¦¨ à¦¹à§à¦°à¦¾à¦¸à¥¤', unknownTitle:'à¦…à¦œà¦¾à¦¨à¦¾'},
  bn:{ tooDryTitle:'à¦…à¦¤à¦¿à¦¶à¦¯à¦¼ à¦¶à§à¦•à¦¨à§‹ â€” à¦•à§à¦·à¦¤à¦¿à¦—à§à¦°à¦¸à§à¦¤', tooDryDesc:'à¦¬à§€à¦œà§‡à¦° à¦†à¦°à§à¦¦à§à¦°à¦¤à¦¾ à¦–à§à¦¬ à¦•à¦®à¥¤ à¦—à§à¦£à¦®à¦¾à¦¨ à¦¹à§à¦°à¦¾à¦¸ à¦¹à¦¤à§‡ à¦ªà¦¾à¦°à§‡à¥¤', idealTitle:'à¦†à¦¦à¦°à§à¦¶ à¦†à¦°à§à¦¦à§à¦°à¦¤à¦¾ â€” à¦­à¦¾à¦²', idealDesc:'à¦¸à¦‚à¦°à¦•à§à¦·à¦£ à¦à¦¬à¦‚ à¦¬à¦ªà¦¨à§‡à¦° à¦œà¦¨à§à¦¯ à¦…à¦¨à§à¦•à§‚à¦²à¥¤', tooWetTitle:'à¦…à¦¤à¦¿à¦­à§‡à¦œà¦¾ â€” à¦¬à¦¿à¦ªà¦¦à¦œà¦¨à¦•', tooWetDesc:'à¦›à¦¤à§à¦°à¦¾à¦•à§‡à¦° à¦à§à¦à¦•à¦¿ à¦“ à¦—à§à¦£à¦—à¦¤ à¦¹à§à¦°à¦¾à¦¸à¥¤', unknownTitle:'à¦…à¦œà¦¾à¦¨à¦¾'},
  brx:{ tooDryTitle:'à¤¬à¤¾à¤¡à¥‹ à¤¸à¥‚à¤–à¤¾à¤¯ â€” à¤–à¤°à¤¾à¤¬', tooDryDesc:'à¤¬à¤¿à¤¯à¤¾à¤—à¥‹ à¤¨à¤®à¥€ à¤•à¤®à¥¤ à¤®à¥‹à¤² à¤•à¤®à¥€ à¤†à¤¹à¥ˆà¥¤', idealTitle:'à¤¸à¤¹à¥€ à¤¨à¤®à¥€ â€” à¤¬à¤¢à¤¼à¤¿à¤¯à¤¾', idealDesc:'à¤­à¤‚à¤¡à¤¾à¤°à¤£ à¤†à¤° à¤¬à¥‹à¤µà¤¾à¤ˆà¤° à¤²à¥‡à¤² à¤¬à¤¢à¤¼à¤¿à¤¯à¤¾à¥¤', tooWetTitle:'à¤…à¤§à¤¿à¤• à¤—à¥€à¤²à¥‹ â€” à¤œà¥‹à¤–à¤¿à¤®', tooWetDesc:'à¤«à¤‚à¤—à¤¸ à¤–à¤¤à¤°à¤¾, à¤—à¥à¤£à¤µà¤¤à¥à¤¤à¤¾ à¤˜à¤Ÿà¥‡à¤¤à¥‡à¥¤', unknownTitle:'à¤…à¤œà¥à¤žà¤¾à¤¤'},
  doi:{ tooDryTitle:'à¤¬à¤¹à¥à¤¤ à¤¸à¥‚à¤–à¤¾ â€” à¤–à¤°à¤¾à¤¬', tooDryDesc:'à¤¬à¥€à¤œ à¤•à¥€ à¤¨à¤®à¥€ à¤¬à¤¹à¥à¤¤ à¤•à¤® à¤¹à¥ˆà¥¤ à¤—à¥à¤£ à¤˜à¤Ÿ à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤', idealTitle:'à¤‰à¤¤à¥à¤¤à¤® à¤¨à¤®à¥€ â€” à¤…à¤šà¥à¤›à¤¾', idealDesc:'à¤¸à¤‚à¤—à¥à¤°à¤¹ à¤”à¤° à¤¬à¥à¤µà¤¾à¤ˆ à¤•à¥‡ à¤²à¤¿à¤ à¤…à¤šà¥à¤›à¤¾à¥¤', tooWetTitle:'à¤¬à¤¹à¥à¤¤ à¤—à¥€à¤²à¤¾ â€” à¤–à¤¤à¤°à¤¾', tooWetDesc:'à¤«à¤«à¥‚à¤‚à¤¦à¥€ à¤¤à¤¥à¤¾ à¤—à¥à¤£à¤µà¤¤à¥à¤¤à¤¾ à¤¹à¤¾à¤¨à¤¿à¥¤', unknownTitle:'à¤…à¤¸à¥à¤ªà¤·à¥à¤Ÿ'},
  gu:{ tooDryTitle:'àª–à«‚àª¬ àª¸à«‚àª•à«àª‚ â€” àª–àª°àª¾àª¬', tooDryDesc:'àª¬à«€àªœàª¨à«€ àª­à«‡àªœ àª–à«‚àª¬ àª“àª›àª¾ àª›à«‡. àª—à«àª£àªµàª¤à«àª¤àª¾ àª˜àªŸà«€ àª¶àª•à«‡ àª›à«‡.', idealTitle:'àª†àª¦àª°à«àª¶ àª­à«‡àªœ â€” àª¸àª¾àª°à«‹', idealDesc:'àª¸àª‚àª—à«àª°àª¹ àª…àª¨à«‡ àªµàª¾àªµàª£à«€ àª®àª¾àªŸà«‡ àª…àª¨à«àª•à«‚àª³.', tooWetTitle:'àª–à«‚àª¬ àª­à«€àª£ â€” àªœà«‹àª–àª®', tooWetDesc:'àª«à«‚àª—àª¨à«‹ àª–àª¤àª°à«‹, àª—à«àª£àªµàª¤à«àª¤àª¾ àª–àª¤àª®.', unknownTitle:'àª…àªœà«àªžàª¾àª¤'},
  kn:{ tooDryTitle:'à²¤à³€à²µà³à²° à²’à²£ â€” à²¬à²¦à³', tooDryDesc:'à²¬à³€à²œà²¦ à²¤à³‡à²µà²¾à²‚à²¶ à²¤à³à²‚à²¬à²¾ à²•à²¡à²¿à²®à³†. à²—à³à²£à²®à²Ÿà³à²Ÿ à²•à²Ÿà³à²Ÿà²¿ à²¹à³‹à²—à²¬à²¹à³à²¦à³.', idealTitle:'à²‰à²¤à³à²¤à²® à²¤à³‡à²µ â€” à²‰à²¤à³à²¤à²®', idealDesc:'à²¸à²‚à²—à³à²°à²¹ à²®à²¤à³à²¤à³ à²¬à²¿à²¤à³à²¤à²¨à³†à²—à³† à²¸à³‚à²•à³à²¤.', tooWetTitle:'à²¤à³€à²µà³à²° à²¤à³‡à²µ â€” à²…à²ªà²¾à²¯', tooWetDesc:'à²«à²‚à²—à²¸à³ à²¸à²‚à²­à²µà²¨à³€à²¯à²¤à³†, à²—à³à²£à²®à²Ÿà³à²Ÿ à²•à³†à²¡à²¬à²¹à³à²¦à³.', unknownTitle:'à²…à²¸à³à²ªà²·à³à²Ÿ'},
  ks:{ tooDryTitle:'Ø¨ÛØª Ø®Ø´Ú© â€” Ø®Ø±Ø§Ø¨', tooDryDesc:'Ø¨ÛŒØ¬ Ú©ÛŒ Ù†Ù…ÛŒ Ø¨ÛØª Ú©Ù…Û” Ú©ÙˆØ§Ù„Ù¹ÛŒ Ú©Ù… ÛÙˆØ³Ú©ØªÛŒ ÛÛ’Û”', idealTitle:'Ù…Ù†Ø§Ø³Ø¨ Ù†Ù…ÛŒ â€” Ø§Ú†Ú¾Ø§', idealDesc:'Ø°Ø®ÛŒØ±Û Ø§ÙˆØ± Ø¨ÙˆØ§Ø¦ÛŒ Ú©Û’ Ù„Ø¦Û’ Ø¨ÛØªØ±Û”', tooWetTitle:'Ø¨ÛØª Ú¯ÛŒÙ„Ø§ â€” Ø®Ø·Ø±Û', tooWetDesc:'ÙÙ†Ú¯Ø³ Ú©Ø§ Ø®Ø·Ø±ÛØŒ Ú©ÙˆØ§Ù„Ù¹ÛŒ Ú©Ù….', unknownTitle:'Ù†Ø§Ù…Ø¹Ù„ÙˆÙ…'},
  kok:{ tooDryTitle:'à¤«à¤¾à¤° à¤¸à¥à¤•à¤¾à¤‚ â€” à¤µà¤¾à¤ˆà¤Ÿ', tooDryDesc:'à¤¬à¥€à¤œà¤¾à¤šà¥€ à¤“à¤²à¤¾à¤µà¤¾ à¤–à¥‚à¤ª à¤•à¤®à¥€. à¤—à¥à¤£à¤µà¤¾à¤°à¥€ à¤•à¤®à¥€ à¤¹à¥‹à¤µà¤• à¤¶à¤•à¤¤.', idealTitle:'à¤¯à¥‹à¤—à¥à¤¯ à¤“à¤²à¤¾à¤µà¤¾ â€” à¤šà¤¾à¤‚à¤—à¤²à¤‚', idealDesc:'à¤¸à¤¾à¤ à¤µà¤£ à¤µ à¤ªà¥‡à¤°à¤£à¥€à¤¸à¤¾à¤ à¥€ à¤¯à¥‹à¤—à¥à¤¯.', tooWetTitle:'à¤«à¤¾à¤° à¤“à¤²à¤¾ â€” à¤§à¥‹à¤•à¤¾', tooWetDesc:'à¤«à¥à¤—à¥€à¤šà¥€ à¤¶à¤•à¥à¤¯à¤¤à¤¾, à¤—à¥à¤£à¤µà¤¤à¥à¤¤à¤¾ à¤•à¤®à¥€.', unknownTitle:'à¤…à¤œà¥à¤žà¤¾à¤¤'},
  mai:{ tooDryTitle:'à¤¬à¤¹à¥à¤¤ à¤¸à¥à¤–à¤² â€” à¤–à¤°à¤¾à¤¬', tooDryDesc:'à¤¬à¥€à¤œà¤• à¤¨à¤®à¥€ à¤¬à¤¹à¥à¤¤ à¤•à¤® à¤…à¤›à¤¿à¥¤ à¤—à¥à¤£à¤µà¤¤à¥à¤¤à¤¾ à¤˜à¤Ÿà¤¿ à¤¸à¤•à¥ˆà¤¤ à¤…à¤›à¤¿à¥¤', idealTitle:'à¤‰à¤¤à¥à¤¤à¤® à¤¨à¤®à¥€ â€” à¤¨à¥€à¤•', idealDesc:'à¤¸à¤‚à¤—à¥à¤°à¤¹ à¤† à¤°à¥‹à¤ªà¤¨à¥€ à¤²\' à¤‰à¤ªà¤¯à¥à¤•à¥à¤¤à¥¤', tooWetTitle:'à¤¬à¤¹à¥à¤¤ à¤­à¥€à¤œà¤² â€” à¤–à¤¤à¤°à¤¾', tooWetDesc:'à¤«à¤«à¥‚à¤‚à¤¦à¥€à¤• à¤–à¤¤à¤°à¤¾, à¤—à¥à¤£ à¤˜à¤Ÿà¤¿ à¤¸à¤•à¥ˆà¤¤ à¤…à¤›à¤¿à¥¤', unknownTitle:'à¤…à¤œà¥à¤žà¤¾à¤¤'},
  mni:{ tooDryTitle:'ê¯‘ê¯£ê¯¡ê¯…ê¯¥ ê¯‡ê¯£ê¯¡ â€” ê¯ê¯¤ê¯– ê¯€ê¯¨ê¯”ê¯•', tooDryDesc:'ê¯ê¯¤ê¯–-gi ê¯‡ê¯¨ê¯”ê¯ê¯¤ ê¯šê¯¥ê¯ˆê¯¤ ê¯‡ê¯£ê¯¡', idealTitle:'ê¯‘ê¯£ê¯¡ê¯…ê¯¥ ê¯ƒê¯¤ê¯¡ê¯ê¯¥ê¯¡ â€” ê¯ƒê¯¥ê¯¡ê¯ê¯¤', idealDesc:'ê¯ê¯¤ê¯–-gi ê¯ê¯£ê¯¡ê¯—ê¯¥ ê¯Šê¯ ê¯…ê¯¥', tooWetTitle:'ê¯‘ê¯£ê¯¡ê¯…ê¯¥ ê¯‘ê¯ƒê¯ê¯¤ â€” ê¯‘ê¯ˆê¯£ê¯›ê¯„ê¯¤', tooWetDesc:'ê¯‘ê¯ˆê¯£ê¯›ê¯„ê¯¤ ê¯‘ê¯¦ê¯‚ê¯¥ ê¯ê¯¥ê¯›ê¯„', unknownTitle:'ê¯‚ê¯¥ê¯£ê¯›ê¯„'},
  mr:{ tooDryTitle:'à¤–à¥‚à¤ª à¤¸à¥à¤•à¤²à¥‡à¤²à¥‡ â€” à¤µà¤¾à¤ˆà¤Ÿ', tooDryDesc:'à¤¬à¤¿à¤¯à¤¾à¤£à¥à¤¯à¤¾à¤šà¥€ à¤“à¤²à¤¾à¤µà¤¾ à¤–à¥‚à¤ª à¤•à¤®à¥€. à¤—à¥à¤£à¤µà¤¤à¥à¤¤à¥‡à¤¤ à¤˜à¤Ÿ à¤¹à¥‹à¤Š à¤¶à¤•à¤¤à¥‡.', idealTitle:'à¤¯à¥‹à¤—à¥à¤¯ à¤“à¤²à¤¾à¤µà¤¾ â€” à¤šà¤¾à¤‚à¤—à¤²à¥‡', idealDesc:'à¤¸à¤¾à¤ à¤µà¤£ à¤†à¤£à¤¿ à¤ªà¥‡à¤°à¤£à¥€à¤¸à¤¾à¤ à¥€ à¤¯à¥‹à¤—à¥à¤¯.', tooWetTitle:'à¤œà¤¾à¤¸à¥à¤¤ à¤“à¤²à¥‡ â€” à¤§à¥‹à¤•à¤¾', tooWetDesc:'à¤¬à¥à¤°à¤¶à¥€à¤šà¤¾ à¤§à¥‹à¤•à¤¾ à¤†à¤£à¤¿ à¤—à¥à¤£à¤µà¤¤à¥à¤¤à¤¾ à¤¹à¤¾à¤¨à¥€.', unknownTitle:'à¤…à¤¸à¥à¤ªà¤·à¥à¤Ÿ'},
  ne:{ tooDryTitle:'à¤§à¥‡à¤°à¥ˆ à¤¸à¥à¤•à¥à¤–à¤¾ â€” à¤–à¤°à¤¾à¤¬', tooDryDesc:'à¤¬à¤¿à¤‰à¤•à¥‹ à¤¨à¤®à¥€ à¤˜à¤Ÿà¥‡à¤•à¥‹ à¤›à¥¤ à¤—à¥à¤£à¤¸à¥à¤¤à¤° à¤˜à¤Ÿà¥à¤¨ à¤¸à¤•à¥à¤›à¥¤', idealTitle:'à¤‰à¤šà¤¿à¤¤ à¤†à¤°à¥à¤¦à¥à¤°à¤¤à¤¾ â€” à¤°à¤¾à¤®à¥à¤°à¥‹', idealDesc:'à¤­à¤£à¥à¤¡à¤¾à¤°à¤£ à¤° à¤°à¥‹à¤ªà¤¾à¤‡à¤à¤•à¤¾ à¤²à¤¾à¤—à¤¿ à¤°à¤¾à¤®à¥à¤°à¥‹à¥¤', tooWetTitle:'à¤§à¥‡à¤°à¥ˆ à¤­à¤¿à¤œà¥‡à¤•à¥‹ â€” à¤–à¤¤à¤°à¤¾', tooWetDesc:'à¤›à¤¾à¤²à¤¾ / à¤«à¤«à¥‚à¤‚à¤¦à¤•à¥‹ à¤–à¤¤à¤°à¤¾, à¤—à¥à¤£à¤¸à¥à¤¤à¤° à¤˜à¤Ÿà¥à¤›à¥¤', unknownTitle:'à¤…à¤œà¥à¤žà¤¾à¤¤'},
  od:{ tooDryTitle:'à¬¬à¬¹à­à¬¤ à¬¸à­à¬•à¬¾ â€” à¬–à¬°à¬¾à¬ª', tooDryDesc:'à¬¬à¬¿à¬œà¬° à¬†à¬°à­à¬¦à­à¬°à¬¤à¬¾ à¬–à­à¬¬ à¬•à¬®à­à¥¤ à¬—à­à¬£à¬®à¬¾à¬¨ à¬•à¬®à¬¿à¬ªà¬¾à¬°à­‡à¥¤', idealTitle:'à¬‰à¬¤à­à¬¤à¬® à¬†à¬°à­à¬¦à­à¬°à¬¤à¬¾ â€” à­Ÿà­‹à¬—à­à­Ÿ', idealDesc:'à¬¸à¬žà­à¬šà­Ÿ à¬“ à¬ªà­à¬°à¬¤à¬¿à¬°à­‹à¬ªà¬£ à¬ªà¬¾à¬‡à¬ à¬­à¬²à¥¤', tooWetTitle:'à¬…à¬¤à¬¿ à¬ªà¬¿à¬†à¬¸à¬¾ â€” à¬à­à¬•à¬¿', tooWetDesc:'à¬«à¬™à­à¬—à¬¸à­â€Œ à¬à­à¬•à¬¿, à¬—à­à¬£à¬®à¬¾à¬¨ à¬•à¬®à­‡à¥¤', unknownTitle:'à¬…à¬œà¬£à¬¾'},
  pa:{ tooDryTitle:'à¨¬à¨¹à©à¨¤ à¨¸à©à©±à¨•à¨¾ â€” à¨–à¨°à¨¾à¨¬', tooDryDesc:'à¨¬à©€à¨œ à¨¦à©€ à¨¨à¨®à©€ à¨¬à¨¹à©à¨¤ à¨˜à©±à¨Ÿ à¨¹à©ˆà¥¤ à¨—à©à¨£à¨µà©±à¨¤à¨¾ à¨˜à©±à¨Ÿ à¨¹à©‹ à¨¸à¨•à¨¦à©€ à¨¹à©ˆà¥¤', idealTitle:'à¨‰à©±à¨šà©€ à¨¨à¨®à©€ â€” à¨šà©°à¨—à¨¾', idealDesc:'à¨¸à¨Ÿà©‹à¨°à©‡à¨œ à¨…à¨¤à©‡ à¨¬à©‚à©°à¨¦ à¨²à¨ˆ à¨‰à¨šà¨¿à¨¤à¥¤', tooWetTitle:'à¨¬à¨¹à©à¨¤ à¨—à©€à¨²à¨¾ â€” à¨–à¨¼à¨¤à¨°à¨¾', tooWetDesc:'à¨«à¨¼à©°à¨—à¨¸ à¨¦à¨¾ à¨–à¨¼à¨¤à¨°à¨¾, à¨—à©à¨£à¨µà©±à¨¤à¨¾ à¨˜à¨Ÿà¨¦à©€ à¨¹à©ˆà¥¤', unknownTitle:'à¨…à¨£à¨œà¨¾à¨£à¨¿à¨†'},
  sa:{ tooDryTitle:'à¤…à¤¤à¤¿à¤¶à¥à¤·à¥à¤•à¤®à¥ â€” à¤¦à¥‚à¤·à¤£à¤®à¥', tooDryDesc:'à¤¬à¥€à¤œà¤¾à¤¨à¤¾à¤‚ à¤†à¤¦à¥à¤°à¤¤à¤¾ à¤…à¤¤à¥€à¤¨à¥à¤¯à¥‚à¤¨à¤ƒà¥¤ à¤—à¥à¤£à¥‡ à¤¹à¥à¤°à¤¾à¤¸à¤ƒ à¤¸à¥à¤¯à¤¾à¤¤à¥à¥¤', idealTitle:'à¤‰à¤¤à¥à¤¤à¤®à¤¾ à¤†à¤¦à¥à¤°à¤¤à¤¾ â€” à¤‰à¤¤à¥à¤¤à¤®', idealDesc:'à¤¸à¤‚à¤—à¥à¤°à¤¹à¤¾à¤¯ à¤š à¤°à¥‹à¤ªà¤£à¤¾à¤¯ à¤‰à¤ªà¤¯à¥à¤•à¥à¤¤à¤®à¥à¥¤', tooWetTitle:'à¤…à¤¤à¤¿à¤“à¤¦à¤• â€” à¤œà¥‹à¤–à¤¿à¤®', tooWetDesc:'à¤•à¤¾à¤²à¤•à¤ƒ à¤œà¥‹à¤–à¤¿à¤®à¤ƒ, à¤—à¥à¤£à¤ƒ à¤¹à¥à¤°à¤¾à¤¸à¤ƒà¥¤', unknownTitle:'à¤…à¤œà¥à¤žà¤¾à¤¤à¤ƒ'},
  sat:{ tooDryTitle:'á±µá±Ÿá±¨ á±›á±Ÿá±¦á±Ÿ â€” á±¥á±Ÿá±¦á±Ÿá±±', tooDryDesc:'á±µá±¤á±¡á±Ÿ á±®á±›á±Ÿ á± á±šá±± á±µá±šá±¨á±œ', idealTitle:'á±Ÿá±¢á±Ÿ á± á±šá±± â€” á±µá±Ÿá±žá±Ÿ', idealDesc:'á±µá±¤á±¡á±Ÿ á± á±šá±± á± á±šá±± á±µá±šá±¨á±œ', tooWetTitle:'á±µá±Ÿá±¨ á±¯á±¤á±¡á±Ÿ â€” á± á±šá±±', tooWetDesc:'á±¯á±·á±Ÿá±± á± á±šá±± á±µá±¤á±¡á±Ÿ á± á±Ÿá±¦á±Ÿá±¹', unknownTitle:'á±Ÿá±¹á±œá±Ÿá±›'},
  sd:{ tooDryTitle:'ØªÙ…Ø§Ù… Ù¿ÙÙ„ â€” Ø®Ø±Ø§Ø¨', tooDryDesc:'Ù»Ø¬ Ø¬ÙŠ Ù†Ù…ÙŠ Ú¯Ú¾Ù½ Ø¢Ù‡ÙŠ. Ù…Ø¹ÙŠØ§Ø± Ù…ØªØ§Ø«Ø± Ù¿ÙŠ Ø³Ú¯Ù‡ÙŠ Ù¿Ùˆ.', idealTitle:'Ù…Ù†Ø§Ø³Ø¨ Ù†Ù…ÙŠ â€” Ø³ÙºÙˆ', idealDesc:'Ø°Ø®ÙŠØ±Ùˆ Û½ Ù¾ÙˆÚ© Ù„Ø§Ø¡Ù Ù…Ù†Ø§Ø³Ø¨.', tooWetTitle:'ØªÙ…Ø§Ù… Ú¯Ù‡Ú»Ùˆ Ú¯Ù†Ø¯Ùˆ â€” Ø®Ø·Ø±Ùˆ', tooWetDesc:'Ú¦Ú¦ÙˆÙ†Ú¾ Ø¬Ùˆ Ø®Ø¯Ø´ÙˆØŒ Ù…Ø¹ÙŠØ§Ø± Ú¯Ú¾Ù½Ø¬ÙŠ Ù¿Ùˆ.', unknownTitle:'Ù†Ø§Ù…Ø¹Ù„ÙˆÙ…'},
  ta:{ tooDryTitle:'à®®à®¿à®•à®šà¯ à®šà®¾à®•à®Ÿà¯ˆà®¨à¯à®¤à®¤à¯ â€” à®¤à¯€à®®à¯ˆ', tooDryDesc:'à®®à®•à¯à®•à®¾à®© à®ˆà®°à®ªà¯à®ªà®¤à®®à¯ à®®à®¿à®•à®•à¯ à®•à¯à®±à¯ˆà®µà¯. à®µà®¿à®¤à®¿à®•à®³à®¿à®©à¯ à®µà®³à®°à¯à®šà¯à®šà®¿ à®ªà®¾à®¤à®¿à®•à¯à®•à®²à®¾à®®à¯.', idealTitle:'à®‰à®¤à¯à®¤à®® à®ˆà®°à®ªà¯à®ªà®¤à®®à¯ â€” à®¨à®²à¯à®²à®¤à¯', idealDesc:'à®šà®®à®°à¯à®ªà¯à®ªà®¿à®•à¯à®•à¯à®®à¯ à®®à®±à¯à®±à¯à®®à¯ à®µà®¿à®¤à¯ˆà®¨à®¾à®•à®®à¯ à®šà®¿à®±à®¨à¯à®¤à®¤à¯.', tooWetTitle:'à®®à®¿à®• à®…à®¤à®¿à®• à®ˆà®°à®ªà¯à®ªà®¤à®®à¯ â€” à®†à®ªà®¤à¯à®¤à¯', tooWetDesc:'à®ªà¯à®´à¯à®•à¯ à®•à®¾à®¯à¯à®šà¯à®šà®¿ à®µà®¾à®¯à¯à®ªà¯à®ªà¯, à®¤à®°à®®à¯ à®•à¯à®±à¯ˆà®µà¯.', unknownTitle:'à®¤à¯†à®°à®¿à®¯à®µà®¿à®²à¯à®²à¯ˆ'},
  te:{ tooDryTitle:'à°šà°¾à°²à°¾ à°Žà°‚à°¡à°¿à°ªà±‹à°¯à°¿à°‚à°¦à°¿ â€” à°šà±†à°¤à±à°¤', tooDryDesc:'à°•à±à°°à±à°ªà± à°¤à±‡à°® à°¤à°•à±à°•à±à°µ. à°µà°¿à°¤à±à°¤à°¨ à°¶à°•à±à°¤à°¿ à°¤à°—à±à°—à°µà°šà±à°šà±.', idealTitle:'à°†à°¦à°°à±à°¶ à°¤à±‡à°® â€” à°®à°‚à°šà°¿à°¦à°¿', idealDesc:'à°¸à°‚à°—à±à°°à°¹à°‚ à°®à°°à°¿à°¯à± à°¸à°¾à°—à± à°•à±‹à°¸à°‚ à°®à°‚à°šà°¿.', tooWetTitle:'à°šà°¾à°²à°¾ à°¤à°¡à°¿ â€” à°ªà±à°°à°®à°¾à°¦à°‚', tooWetDesc:'à°ªà°Ÿà±à°Ÿà±/à°ªà±Šà°¡à±à°šà± à°ªà±à°°à°®à°¾à°¦à°‚, à°¨à°¾à°£à±à°¯à°¤ à°¤à°—à±à°—à±.', unknownTitle:'à°¤à±†à°²à°¿à°¯à°¦à±'}
};

/* Populate language selector */
const langSel = document.getElementById('langSelect');
LANGS.forEach(l=>{ const o=document.createElement('option'); o.value=l.code; o.textContent=l.name; langSel.appendChild(o); });
langSel.value='en';

/* DOM refs */
const enableAudioBtn = document.getElementById('enableAudio');
const openCamBtn = document.getElementById('openCam');
const scanBtn = document.getElementById('scanBtn');
const resetBtn = document.getElementById('resetBtn');
const calibrateBtn = document.getElementById('calibrateBtn');
const downloadBtn = document.getElementById('downloadBtn');

const videoEl = document.getElementById('video');
const swatchEl = document.getElementById('swatch');
const rgbText = document.getElementById('rgbText');
const hsvText = document.getElementById('hsvText');

const detectedState = document.getElementById('detectedState');
const confEl = document.getElementById('confidence');
const statusBadge = document.getElementById('statusBadge');
const meterFill = document.getElementById('meterFill');
const scoreText = document.getElementById('scoreText');
const adviceText = document.getElementById('adviceText');

const seedSelect = document.getElementById('seedSelect');
const customName = document.getElementById('customName');
const saveBtn = document.getElementById('saveBtn');
const speakBtn = document.getElementById('speakBtn');
const historyList = document.getElementById('historyList');

let stream = null;
let audioCtx = null;
let lastReport = null;

/* ---------------- Audio unlock ---------------- */
enableAudioBtn.addEventListener('click', ()=>{
  try{
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if(audioCtx.state === 'suspended') audioCtx.resume();
    // tiny beep to indicate enabled
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.frequency.value = 880; o.type='sine'; o.connect(g); g.connect(audioCtx.destination);
    g.gain.setValueAtTime(0.0001, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime+0.01);
    o.start(); setTimeout(()=>{ g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.02); o.stop(audioCtx.currentTime+0.03); }, 120);
    enableAudioBtn.textContent = STRINGS[langSel.value].audioEnabled || STRINGS.en.audioEnabled;
  }catch(e){ console.warn('audio unlock', e); }
});

/* ---------- choose rear device helper ---------- */
async function chooseRearDeviceId(){
  try{
    const devices = await navigator.mediaDevices.enumerateDevices();
    const videoInputs = devices.filter(d=>d.kind==='videoinput');
    // prefer labels with back/rear/environment
    for(const d of videoInputs){
      const lab = (d.label||'').toLowerCase();
      if(/back|rear|environment|camera 0|camera1|rear camera/.test(lab)) return d.de